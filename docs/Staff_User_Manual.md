# คู่มือการใช้งานระบบ (Staff)

เอกสารฉบับนี้เป็นคู่มือการใช้งานสำหรับพนักงาน (Staff) ของระบบ Inventory Management โดยอธิบายการทำงานของแต่ละหน้าในฝั่ง Staff แยกเป็นรายงาน พร้อมหน้าที่/วัตถุประสงค์ และขั้นตอนการใช้งานหลัก

---

## 1) ภาพรวมระบบฝั่ง Staff

### 1.1 บทบาท (Role)
- Staff สามารถเข้าหน้า `/staff/*` ได้
- ใช้สำหรับ:
  - ค้นหา/เลือกสินค้าเพื่อเพิ่มลงตะกร้าเบิก
  - สร้างคำขอเบิก (Withdrawal Request)
  - ดูประวัติคำขอเบิกของตนเอง และรายละเอียดคำขอเบิก
  - จัดการโปรไฟล์และข้อมูลการจัดส่ง

### 1.2 เส้นทาง (Routes) ที่เกี่ยวข้อง
อ้างอิงจากไฟล์: `src/App.js`

- `/staff` → Dashboard (รายการสินค้า)
- `/staff/withdraw` → ตะกร้า/แบบฟอร์มคำขอเบิก
- `/staff/orders` → รายการคำขอเบิกของฉัน
- `/staff/orders/:id` → รายละเอียดคำขอเบิก
- `/staff/profile` → โปรไฟล์พนักงาน

---

## 2) คู่มือแยกตามหน้า (รายงานการทำงาน)

> รูปแบบหัวข้อในแต่ละหน้า:
> - วัตถุประสงค์
> - ไฟล์ที่เกี่ยวข้อง
> - เส้นทาง (Route)
> - การทำงานหลัก
> - ขั้นตอนการใช้งาน (แนะนำ)
> - หมายเหตุ/ข้อควรระวัง

---

## 2.1 Staff Layout (โครงหน้า + เมนู)

### วัตถุประสงค์
เป็นโครงหน้าหลัก (Layout) ของทุกหน้าในฝั่ง Staff ประกอบด้วย Sidebar, Top Header (Search/Cart/Language) และพื้นที่แสดงเนื้อหาของแต่ละหน้า

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/StaffLayout.jsx`
- `src/pages/staff/StaffLayout.module.css`

### เส้นทาง (Route)
- ใช้เป็น Layout ครอบทุก route ภายใต้ `/staff/*` (กำหนดใน `src/App.js`)

### การทำงานหลัก
- แสดงเมนูนำทางหลัก:
  - `/staff` (Dashboard)
  - `/staff/withdraw` (Withdraw)
  - `/staff/orders` (Orders)
  - `/staff/profile` (Profile)
- แสดง Search bar ใน Top Header และส่งค่า `searchQuery` ไปให้หน้าลูกผ่าน `Outlet context`
- แสดงปุ่ม Cart พร้อม badge จำนวนสินค้าที่อยู่ในตะกร้าเบิก
- รองรับเปลี่ยนภาษา (LanguageSwitcher)
- ออกจากระบบด้วย `signOut(auth)`

### ขั้นตอนการใช้งาน (แนะนำ)
1. ล็อกอินด้วย role = staff
2. ใช้ Sidebar เพื่อเปลี่ยนหน้า
3. ใช้ Search ที่หัวหน้าเพื่อค้นหาสินค้าบนหน้า Dashboard
4. กดปุ่ม Cart เพื่อไปหน้า Withdraw

### หมายเหตุ/ข้อควรระวัง
- Badge ตะกร้าจะอัปเดตจาก event `staff-cart-updated` ที่หน้าต่าง (window)
- Logo ดึงจาก `public/Inventory Hub .png` (มีเว้นวรรคก่อน .png)

---

## 2.2 Staff Dashboard (รายการสินค้า)

### วัตถุประสงค์
ให้พนักงานสามารถค้นหา/เลือกสินค้า ตรวจสอบสถานะสต็อก และเพิ่มสินค้าลงตะกร้าเบิกได้อย่างรวดเร็ว

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/StaffDashboard.jsx`
- `src/pages/staff/StaffDashboard.module.css`

### เส้นทาง (Route)
- `/staff`

### การทำงานหลัก
- โหลดรายการสินค้าจาก `getAllProducts()`
- กรองสินค้าที่เบิกได้โดยคำนวณ stock ที่เหลือสำหรับ staff:
  - `availableForStaff = quantity - reserved - staffReserved`
- รองรับค้นหา (Search) ผ่าน `searchQuery` (รับจาก `StaffLayout` ผ่าน `Outlet context`)
  - ค้นหาได้จาก: ชื่อสินค้า, หมวดหมู่, รายละเอียด, SKU/รหัสสินค้า
- กรองตามหมวดหมู่ (Category chips)
- Pagination แสดงสินค้าตามหน้า
- เมื่อกด “เพิ่ม” จะเปิด Modal เพื่อ:
  - เลือก variant (ถ้ามี)
  - เลือกจำนวน
  - เพิ่มลงตะกร้าผ่าน `addToCart(uid, cartItem, 'staff')`

### ขั้นตอนการใช้งาน (แนะนำ)
1. เข้า `/staff`
2. ใช้ Search เพื่อค้นหาสินค้า (ชื่อ/หมวด/รหัส)
3. เลือกหมวดหมู่ที่ต้องการจาก chips
4. กดปุ่ม “+” บนสินค้าเพื่อเปิด modal
5. เลือก variant และจำนวน แล้วกด Add to Cart
6. ไปหน้า `/staff/withdraw` เพื่อยืนยันคำขอเบิก

### หมายเหตุ/ข้อควรระวัง
- หากสินค้าเป็นแบบ variant ต้องเลือก variant ก่อนจึงจะเพิ่มลงตะกร้าได้
- หาก stock สำหรับ staff เหลือ 0 จะไม่สามารถกดเพิ่มได้

---

## 2.3 Withdraw Page (ตะกร้า/แบบฟอร์มคำขอเบิก)

### วัตถุประสงค์
ใช้สำหรับตรวจสอบสินค้าในตะกร้า ปรับจำนวน/ลบรายการ และกรอกแบบฟอร์มเพื่อสร้างคำขอเบิก (Withdrawal Request)

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/WithdrawPage.jsx`

### เส้นทาง (Route)
- `/staff/withdraw`

### การทำงานหลัก
- โหลดรายการสินค้าในตะกร้าจาก `getCart(uid, 'staff')`
- ปรับจำนวนสินค้าในตะกร้าผ่าน `updateCartItem(uid, itemId, quantity, 'staff')`
- ลบสินค้าในตะกร้าผ่าน `removeFromCart(uid, itemId, 'staff')`
- ล้างตะกร้าผ่าน `clearCart(uid, 'staff')`
- กรอกข้อมูลคำขอเบิก (เช่น ผู้ขอเบิก/ผู้รับ/วิธีรับสินค้า/ที่อยู่/วันที่/หมายเหตุ)
- สร้างคำขอเบิกผ่าน `createWithdrawal(uid, payload)`

### ขั้นตอนการใช้งาน (แนะนำ)
1. เข้า `/staff/withdraw`
2. ตรวจสอบรายการสินค้าในตะกร้า
3. ปรับจำนวน/ลบสินค้าให้ถูกต้อง
4. กรอกแบบฟอร์มข้อมูลการเบิก
5. กดปุ่มยืนยัน/ส่งคำขอเบิก
6. หลังสร้างสำเร็จ สามารถไปดูรายการได้ที่ `/staff/orders`

### หมายเหตุ/ข้อควรระวัง
- หากตะกร้าว่าง ระบบจะแสดงสถานะ Empty cart
- ควรตรวจสอบจำนวนที่เบิกไม่เกินจำนวนคงเหลือ

---

## 2.4 Orders Page (รายการคำขอเบิกของฉัน)

### วัตถุประสงค์
แสดงรายการคำขอเบิก (Withdrawals) ของผู้ใช้ staff คนปัจจุบัน พร้อมค้นหา/กรองสถานะ และเข้าไปดูรายละเอียด

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/StaffOrdersPage.jsx`

### เส้นทาง (Route)
- `/staff/orders`

### การทำงานหลัก
- โหลดรายการคำขอเบิกของผู้ใช้ผ่าน `getWithdrawalsByUser(uid)`
- แสดงสรุปสถิติ (เช่น จำนวนทั้งหมด/สถานะต่าง ๆ) ตามที่หน้าแสดง
- ค้นหา (search) และกรองตามสถานะ (status)
- Pagination
- ปุ่มดูรายละเอียด → ไปหน้า `/staff/orders/:id`

### ขั้นตอนการใช้งาน (แนะนำ)
1. เข้า `/staff/orders`
2. ใช้ช่องค้นหาเพื่อหา order ที่ต้องการ (เช่น เลขคำขอ/ชื่อผู้ขอ/ผู้รับ ตามที่หน้าแสดง)
3. เลือกสถานะเพื่อกรองรายการ
4. กด View Details เพื่อดูรายละเอียดรายการ

### หมายเหตุ/ข้อควรระวัง
- หน้านี้ดึงข้อมูลเฉพาะของผู้ใช้ปัจจุบัน (uid)

---

## 2.5 Order Detail (รายละเอียดคำขอเบิก)

### วัตถุประสงค์
แสดงรายละเอียดคำขอเบิกรายการเดียว เช่น รายการสินค้า ที่อยู่จัดส่ง วิธีรับสินค้า สถานะการจัดส่ง/ติดตาม และสรุปยอด

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/StaffOrderDetailPage.jsx`

### เส้นทาง (Route)
- `/staff/orders/:id`

### การทำงานหลัก
- รับ `id` จาก URL params
- โหลดรายการคำขอเบิกของผู้ใช้ผ่าน `getWithdrawalsByUser(uid)` แล้วหา order ที่ id ตรงกัน
- แสดงรายละเอียด:
  - เลขคำขอเบิก/วันที่
  - รายการสินค้าและจำนวน
  - ที่อยู่จัดส่ง/วิธีรับสินค้า
  - tracking / สถานะการจัดส่ง (ถ้ามี)

### ขั้นตอนการใช้งาน (แนะนำ)
1. เข้า `/staff/orders`
2. กด View Details ในรายการที่ต้องการ
3. ตรวจสอบรายละเอียดทั้งหมด
4. กดปุ่มย้อนกลับเพื่อกลับไปหน้ารายการ

### หมายเหตุ/ข้อควรระวัง
- หากเปิด URL ตรง ๆ และโหลดข้อมูลไม่พบ ระบบจะแสดงสถานะ “Order not found”

---

## 2.6 Profile (โปรไฟล์พนักงาน)

### วัตถุประสงค์
ให้ผู้ใช้ staff จัดการข้อมูลส่วนตัว อัปโหลดรูปโปรไฟล์ จัดการที่อยู่จัดส่ง เปลี่ยนรหัสผ่าน และตั้งค่าบัญชีของตนเอง

### ไฟล์ที่เกี่ยวข้อง
- `src/pages/staff/ProfilePage.jsx`

### เส้นทาง (Route)
- `/staff/profile`

### การทำงานหลัก
- โหลด/สร้างข้อมูลโปรไฟล์ผ่าน `ensureUserProfile(uid, email, displayName)`
- แก้ไขข้อมูลโปรไฟล์และบันทึกผ่าน `updateUserProfile(uid, payload)`
- อัปโหลดรูปไป Firebase Storage (`avatars/<uid>`) แล้วอัปเดต `photoURL`
- จัดการ Shipping Addresses:
  - เพิ่มที่อยู่ (`addAddress`)
  - ลบที่อยู่ (`deleteAddress`)
  - ตั้งค่า default (`setDefaultAddress`)
- เปลี่ยนรหัสผ่าน:
  - `reauthenticateWithCredential`
  - `updatePassword`

### ขั้นตอนการใช้งาน (แนะนำ)
1. เข้า `/staff/profile`
2. เปลี่ยนรูปโปรไฟล์ (ถ้าต้องการ)
3. แก้ไขข้อมูลส่วนตัว แล้วกด Save
4. เพิ่ม/ลบ/ตั้งค่า default ที่อยู่ในส่วน Shipping Addresses
5. หากต้องการเปลี่ยนรหัสผ่าน ให้กรอกรหัสเดิมและรหัสใหม่ แล้วกด Update

### หมายเหตุ/ข้อควรระวัง
- การเปลี่ยนรหัสผ่านจำเป็นต้องใส่รหัสเดิมให้ถูกต้อง (reauthentication)
- การอัปโหลดรูปควรเป็นไฟล์ภาพ และขนาดไฟล์เหมาะสม

---

## 3) ภาคผนวก

### 3.1 จุดเริ่มต้นของ Routes
- `src/App.js`

### 3.2 โครงสร้าง Layout
- `src/pages/staff/StaffLayout.jsx`
- `src/pages/staff/StaffLayout.module.css`

---

## Revision
- v1.0: จัดทำคู่มือสตาฟฉบับแรก (อ้างอิงโค้ดใน repo)
